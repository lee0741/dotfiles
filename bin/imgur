#! /usr/bin/env python

import sys, os, json, ic
import requests
import base64 #image handling import

api_key = 'd82fbada06f01af31236848a88f4ca7c'
url = r'http://api.imgur.com/2/upload.json'
image_path = sys.argv[1]

with open(image_path, 'rb') as f:
    b64image = base64.b64encode(f.read())

if len(sys.argv) > 2:
    image_title = sys.argv[2]
else:
    image_title = os.path.basename(os.path.splitext(image_path)[0])

payload = dict(key=api_key, image=b64image, title=image_title)
r = requests.post(url, data=payload)
j = json.loads(r.text)

ic.launchurl(j['upload']['links']['original'])
